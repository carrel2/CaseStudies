{% extends 'base.html.twig' %}

{% block scripts %}
	{{ parent() }}

	<script src="{{ asset('js/accordion.js') }}"></script>
{% endblock %}

{% block body %}
	{% for day in user.days %}
		{% set n = loop.index %}
		{% set elapsed = loop.length - loop.index %}

		<button class="accordion">Day {{ n }}</button>

		<div class="panel">
			<div id="hotspots">
				{% for spot in day.hotspotsinfo %}
					<li><em>{{ spot.hotspot.name }}:</em> {{ spot.info }}</li>
				{% endfor %}

				{% for flash in app.session.flashBag.peek('hotspot-' ~ day.id) %}
					<li><em>{{ flash }}:</em> No information available</li>
				{% endfor %}
			</div>

			<div id="testResults">
				{% for testResult in day.tests %}
					{% if testResult.test.waitTime < elapsed  %}
						<li><em>{{ testResult.test.name }}:</em> {{ testResult.results }}</li>
					{% else %}
						<li><em>{{ testResult.test.name }}:</em> Awaiting results.</li>
					{% endif %}
				{% endfor %}

				{% for flash in app.session.flashBag.peek('empty-diagnostic-results-' ~ day.id) %}
					<li><em>{{ flash }}:</em> No results available</li>
				{% endfor %}
			</div>

			<div id="medicationResults">
				{% for medResult in day.medications %}
					<li><em>{{ medResult.medication.name }}:</em> {{ medResult.results }}</li>
				{% endfor %}

				{% for flash in app.session.flashBag.peek('empty-therapeutic-results-' ~ day.id) %}
					<li><em>{{ flash }}:</em> No results available</li>
				{% endfor %}
			</div>
		</div>
	{% endfor %}

	{% set finished = app.session.get('finished') %}

	{% if finished %}
		{{ form_start(form) }}
		{{ form_widget(form) }}
		{{ form_end(form) }}
	{% else %}
		{% set page = app.session.get('page') %}
		{% if page == 'review' %}
			<a href="{{ path('nextDay') }}">Continue</a>
		{% else %}
			<a href="{{ path(page) }}">Resume</a>
		{% endif %}
	{% endif %}
{% endblock %}
